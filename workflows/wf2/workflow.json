{
    "workflow": {
        "steps": [
            {
                "id": "get-patients",
                "adaptor": "openmrs",
                "configuration": "../tmp/openmrs-creds.json",
                "state": {
                    "lastRunDateTime": "2024-09-29"
                },
                "expression": "1-get-patients.js",
                "next": {
                    "mappings": "!state.errors && state.patients.length > 0"
                }
            },
            {
                "id": "mappings",
                "adaptor": "common",
                "expression": "2-mappings.js",
                "next": {
                    "upsert-teis": "!state.errors"
                }
            },
            {
                "id": "upsert-teis",
                "adaptor": "dhis2",
                "configuration": "../tmp/dhis2-creds.json",
                "expression": "2-upsert-teis.js",
                "next": {
                    "get-encounters": "!state.errors && state.patientUuids.length > 0"
                }
            },
            {
                "id": "get-encounters",
                "adaptor": "http",
                "configuration": "../tmp/openmrs-http.json",
                "expression": "3-get-encounters.js",
                "next": {
                    "get-options-map": "state.encounters.length > 0&& !state.errors"
                }
            },
            {
                "id": "get-options-map",
                "adaptor": "http",
                "expression": "4-get-options-map.js",
                "next": {
                    "get-teis": "!state.errors"
                }
            },
            {
                "id": "get-teis",
                "adaptor": "dhis2",
                "configuration": "../tmp/dhis2-creds.json",
                "expression": "5-get-teis.js",
                "next": {
                    "create-events": "state.TEIs && !state.errors"
                }
            },
            {
                "id": "create-events",
                "adaptor": "dhis2",
                "configuration": "../tmp/dhis2-creds.json",
                "expression": "6-create-events.js",
                "next": {
                    "update-teis": "state.genderUpdated.length > 0 && !state.errors"
                }
            },
            {
                "id": "update-teis",
                "adaptor": "dhis2",
                "configuration": "../tmp/dhis2-creds.json",
                "expression": "7-update-teis.js"
            }
        ]
    }
}